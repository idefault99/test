plugins {
    id 'java-library'
    id 'maven-publish'
}

group = "ru.sogaz.umka"
version = System.getenv("VERSION") ?: "1.0.0-SNAPSHOT"   // можно переопределять в CI

java {
    toolchain { languageVersion = JavaLanguageVersion.of(21) }
    withSourcesJar()
    withJavadocJar()
}

repositories {
    mavenCentral()
}

dependencies {
    api "com.fasterxml.jackson.core:jackson-annotations:2.17.2"
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java

            // если хочешь явно назвать artifactId:
            artifactId = "umka-dto-lib"

            pom {
                name = "umka-dto-lib"
                description = "DTO library for Umka services"
            }
        }
    }

    repositories {
        maven {
            // ДВА URL: releases и snapshots. Выбор по версии -SNAPSHOT
            def releasesRepoUrl  = System.getenv("NEXUS_RELEASES_URL")  ?: "https://nexus.example/repository/maven-releases/"
            def snapshotsRepoUrl = System.getenv("NEXUS_SNAPSHOTS_URL") ?: "https://nexus.example/repository/maven-snapshots/"

            url = version.endsWith("-SNAPSHOT") ? snapshotsRepoUrl : releasesRepoUrl

            credentials {
                username = System.getenv("NEXUS_USER") ?: ""
                password = System.getenv("NEXUS_PASSWORD") ?: ""
            }

            // если у вас самоподписанные сертификаты — лучше решать через доверие JVM, а не "insecure"
        }
    }
}
